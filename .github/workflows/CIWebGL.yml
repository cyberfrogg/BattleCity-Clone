name: Unity CI Pipeline üéª

on: 
    push: { branches: [main] } 

env:
    UNITY_EMAIL: ${{ secrets.UNITY_EMAIL }}
    UNITY_PASSWORD: ${{ secrets.UNITY_PASSWORD }}
    UNITY_SERIAL: ${{ secrets.UNITY_SERIAL }}

jobs:
  buildForWebGL:
    name: Build for Web üñ•Ô∏è
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Restore Library cache
        uses: actions/cache@v2
        with:
          path: Library
          key: Library-build-WebGL
          restore-keys: |
            Library-build-
            Library-
     
      - name: Build Unity
        id: unityBuild
        uses: game-ci/unity-builder@v2   
        with:
          targetPlatform: WebGL


      - name: Upload build to itch.io 
        uses: robpc/itchio-upload-action@v1
        with:
          path: build/WebGL
          project: dipok/bs23-battlecity
          channel: HTML5 / Playable in browser
          version: ${{ steps.unityBuild.outputs.buildVersion}}
          api-key: ${{ secrets.ITCH_API_KEY }}
       
      
   
      #- name: Discord Notification
       # uses: fateyan/action-discord-notifier@v1
        #with:
         # message-title: windows Build Link https://brainstation23.itch.io/westwood-manor
          #webhook: ${{ secrets.DISCORD_WEBHOOK }}
